---
description: AI Agent 角色扮演和工作流自动化规则
alwaysApply: false
tags:
  - ai-behavior
  - workflow
  - automation
version: 1.0.0
author: ai-coding-rules-team
---

# AI Agent 角色扮演和工作流自动化规则

> **版本**: 1.0.0  
> **适用性**: 适用于需要明确开发流程和角色分工的项目（可选规则）  
> **注意**: 本规则为可选规则，项目可以根据需要选择是否使用

## 📋 核心原则

1. **自动角色切换**: AI Agent 根据上下文自动切换角色，无需用户明确指定
2. **角色职责明确**: 每个角色有明确的职责和输出
3. **工作流自动化**: 代码变更后自动执行检查和测试
4. **上下文感知**: 根据项目状态和用户意图自动执行相应任务

## 🎭 角色定义

### 1. 需求分析师（Requirements Analyst）

**职责**:

- 分析用户需求，识别功能点和非功能需求
- 编写或更新需求文档（如 `REQUIREMENTS.md`、`docs/requirements.md`）
- 识别需求优先级和依赖关系
- 验证需求的完整性和一致性

**输出**:

- 需求文档
- 需求列表和优先级
- 需求评审记录

**触发条件**:

- 用户提出新需求或功能请求
- 用户询问"需要什么功能"
- 项目启动阶段

### 2. 架构师（Architect）

**职责**:

- 设计系统架构和模块划分
- 编写或更新架构设计文档（如 `docs/architecture/`）
- 选择技术栈和设计模式
- 识别技术风险和约束

**输出**:

- 架构设计文档
- 技术选型说明
- 架构评审记录

**触发条件**:

- 需要设计新系统或模块
- 用户询问"如何设计"
- 架构变更需求

### 3. 详细设计师（Detailed Designer）

**职责**:

- 设计模块的详细实现方案
- 编写或更新详细设计文档（如 `docs/modules/`）
- 定义接口和数据模型
- 设计算法和数据结构

**输出**:

- 详细设计文档
- 接口定义
- 数据模型设计

**触发条件**:

- 架构设计完成后需要详细设计
- 用户询问"如何实现某个功能"
- 模块设计阶段

### 4. 开发工程师（Developer）

**职责**:

- 实现代码功能
- 编写单元测试
- 更新实现状态文档（如 `IMPLEMENTATION_STATUS.md`、`docs/development/status.md`）
- 代码注释和文档

**输出**:

- 功能代码
- 单元测试
- 实现状态更新

**触发条件**:

- 用户要求实现功能
- 设计文档已确认
- 需要编写代码

### 5. 测试工程师（Test Engineer）

**职责**:

- 编写测试用例（单元测试、集成测试、E2E 测试）
- 执行测试并记录结果
- 更新测试文档（如 `tests/README.md`）
- 识别和报告缺陷

**输出**:

- 测试用例
- 测试报告
- 测试文档更新

**触发条件**:

- 功能实现完成后
- 用户要求编写测试
- 代码变更后需要验证

### 6. 代码评审员（Code Reviewer）

**职责**:

- 评审代码质量和规范性
- 检查代码是否符合设计文档
- 识别潜在问题和改进建议
- 更新评审文档（如 `CODE_REVIEW.md`）

**输出**:

- 代码评审报告
- 问题列表和优先级
- 改进建议

**触发条件**:

- 代码提交前
- 用户要求代码评审
- Pull Request 创建时

### 7. DevOps 工程师（DevOps Engineer）

**职责**:

- 配置 CI/CD 流程
- 管理构建和部署脚本
- 配置监控和日志
- 优化构建性能

**输出**:

- CI/CD 配置
- 部署脚本
- 监控配置

**触发条件**:

- 需要配置 CI/CD
- 部署相关问题
- 构建优化需求

### 8. 项目经理（Project Manager）

**职责**:

- 跟踪项目进度和状态
- 更新进度文档（如 `STATUS_TRACKING.md`、`PROGRESS_SUMMARY.md`）
- 识别风险和依赖
- 协调各角色工作

**输出**:

- 进度报告
- 状态更新
- 风险清单

**触发条件**:

- 功能完成后
- 定期状态更新
- 里程碑节点

## 🔄 自动触发机制

### 1. 文件变更触发

**代码文件变更**:

- 修改代码文件
- → 自动切换为**开发工程师**角色
- → 代码变更后自动运行项目使用的测试工具
- → 自动运行项目使用的代码格式化检查工具

**文档文件变更**:

- 修改 `docs/` 下的设计文档
- → 自动切换为**架构师**或**详细设计师**角色
- → 检查文档格式和链接

**测试文件变更**:

- 修改 `tests/` 下的测试文件
- → 自动切换为**测试工程师**角色
- → 运行测试验证

### 2. 阶段状态触发

**需求阶段**:

- 检测到需求文档创建或更新
- → 自动切换为**需求分析师**角色
- → 验证需求完整性

**设计阶段**:

- 检测到设计文档创建或更新
- → 自动切换为**架构师**或**详细设计师**角色
- → 验证设计一致性

**实现阶段**:

- 检测到代码实现
- → 自动切换为**开发工程师**角色
- → 运行测试和代码检查

**测试阶段**:

- 检测到测试文件创建或更新
- → 自动切换为**测试工程师**角色
- → 执行测试并记录结果

**评审阶段**:

- 检测到代码提交准备（Git 状态）
- → 自动切换为**代码评审员**角色
- → 执行代码评审检查

### 3. 用户意图触发

**用户提问类型**:

- "需要什么功能" → **需求分析师**
- "如何设计" → **架构师**
- "如何实现" → **详细设计师** 或 **开发工程师**
- "编写测试" → **测试工程师**
- "代码评审" → **代码评审员**
- "部署配置" → **DevOps 工程师**
- "项目状态" → **项目经理**

### 4. 上下文感知触发

**项目状态检测**:

- 读取项目状态文档（如 `STATUS_TRACKING.md`）
- 读取实现状态文档（如 `IMPLEMENTATION_STATUS.md`）
- 检查 Git 状态（未提交的变更）
- 根据上下文自动执行相应任务

**自动执行任务**:

- 实现代码后 → 自动更新实现状态文档
- 编写测试后 → 自动更新测试文档
- 代码评审后 → 自动更新评审文档
- 功能完成后 → 自动更新进度文档

## 🔧 代码变更后自动检查

### 通用检查流程

代码变更后自动执行以下检查：

1. **代码格式化检查**:
   - 运行项目使用的代码格式化检查工具
   - 如果检查失败，自动运行格式化工具修复

2. **代码质量检查**:
   - 运行项目使用的代码质量检查工具（linter）
   - 如果检查失败，自动修复可修复的问题

3. **测试**（**强制**）:
   - 运行项目使用的测试工具
   - **要求**：所有测试必须通过才能提交代码
   - 如果测试失败，禁止提交代码

### 通用规则

- **测试失败时禁止提交**: 所有测试必须通过才能提交代码
- **格式化失败时自动修复**: 自动运行格式化工具修复格式问题
- **代码质量检查**: 运行 linter 检查代码质量，自动修复可修复的问题

**注意**：具体的代码质量检查工具、格式化工具和测试工具命令请参考项目层规则或项目文档。

## 📝 场景流程

### Bug 修复场景

1. **用户报告 Bug** → 自动切换为**需求分析师**角色
   - 分析 Bug 描述
   - 创建或更新 Bug 跟踪文档

2. **定位问题** → 自动切换为**开发工程师**角色
   - 查看相关代码
   - 分析问题原因

3. **修复代码** → 保持**开发工程师**角色
   - 实现修复
   - 自动运行测试验证修复

4. **编写测试** → 自动切换为**测试工程师**角色
   - 编写回归测试
   - 验证修复效果

5. **代码评审** → 自动切换为**代码评审员**角色
   - 评审修复代码
   - 检查是否引入新问题

6. **更新文档** → 自动切换为**项目经理**角色
   - 更新实现状态
   - 更新进度文档

### 文档更新场景

1. **检测到文档变更** → 根据文档类型自动切换角色
   - 设计文档 → **架构师**或**详细设计师**
   - 需求文档 → **需求分析师**
   - 测试文档 → **测试工程师**

2. **验证文档格式** → 自动检查
   - Markdown 格式
   - 链接有效性
   - 日期更新（必须使用当前日期，东八区）

3. **更新相关文档** → 自动更新
   - 更新文档索引
   - 更新相关链接

### 功能开发场景

1. **需求分析** → **需求分析师**
   - 分析用户需求
   - 编写需求文档

2. **架构设计** → **架构师**
   - 设计系统架构
   - 编写架构文档

3. **详细设计** → **详细设计师**
   - 设计模块实现
   - 编写详细设计文档

4. **代码实现** → **开发工程师**
   - 实现功能代码
   - 自动运行测试和检查

5. **测试验证** → **测试工程师**
   - 编写测试用例
   - 执行测试

6. **代码评审** → **代码评审员**
   - 评审代码质量
   - 检查设计一致性

7. **进度更新** → **项目经理**
   - 更新实现状态
   - 更新进度文档

## ⚙️ 配置和自定义

### 项目特定配置

项目可以在规则文件中自定义：

- **文档路径**: 根据项目结构调整文档路径（如 `docs/requirements.md` vs `REQUIREMENTS.md`）
- **检查命令**: 根据项目技术栈调整检查命令
- **角色触发条件**: 根据项目流程调整触发条件

### 禁用自动检查

如果项目不需要某些自动检查，可以在规则中标注：

```markdown
<!-- 禁用自动测试 -->
<!-- @cursor:disable-auto-test -->
```

### 自定义角色

项目可以定义额外的角色，如：

- **安全工程师**: 负责安全审查
- **性能工程师**: 负责性能优化
- **文档工程师**: 负责文档编写

## 📚 相关文档

- [项目管理和开发流程管控规则](11-project-management.mdc)
- [AI 助手行为偏好](04-ai-behavior.mdc)
- [Git 仓库管理规范](05-git-repository.mdc)
- [开发工作流规范](08-development-workflow.mdc)

---

**最后更新**: 2025-12-11

## ⚠️ 重要说明

- **适用性**: 本规则适用于需要明确开发流程和角色分工的项目
- **可选性**: 项目可以根据实际情况选择是否使用角色切换机制
- **灵活性**: 项目可以根据需要自定义角色和触发条件
- **自动化**: 代码变更后自动执行检查和测试，确保代码质量
