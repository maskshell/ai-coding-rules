repos:
  # Commit message 格式检查（Conventional Commits）
  # 遵循项目 Git 仓库管理规范：type(scope): subject
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.0.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: [--strict]

  # 敏感信息检查
  # 防止提交密码、密钥等敏感信息（符合 Git 仓库管理规范）
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args: ["--baseline", ".secrets.baseline"]
        exclude: |
          (?x)^(
            .*\.lock\.json$|
            .*\.log$|
            .*\.pyc$|
            __pycache__/.*
          )$

  # Python 代码检查和格式化（Ruff）
  # 与 IDE 中使用的 Ruff 扩展保持一致
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.1
    hooks:
      # Ruff lint（检查代码问题，自动修复）
      - id: ruff
        args: [--fix]
        types: [python]
      # Ruff format（格式化代码）
      - id: ruff-format
        types: [python]

  # JSON 和 YAML 文件检查
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      # JSON 语法检查
      - id: check-json
        types: [json]
      # YAML 语法检查
      - id: check-yaml
        types: [yaml]
      # 检查 JSON 和 YAML 文件末尾是否有换行符
      - id: end-of-file-fixer
        types: [json, yaml]

  # JSON 和 YAML 格式化（使用 prettier）
  # JSON: 与 IDE 内置格式化保持一致
  # YAML: 与 redhat.vscode-yaml 扩展保持一致
  # 配置文件：.prettierrc.yaml
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types: [json, yaml]
        args: [--write]
        # 确保包含 .github/workflows/ 目录下的 YAML 文件
        files: \.(json|yaml|yml)$

  # 本地脚本检查
  - repo: local
    hooks:
      # Markdown 格式化（自动修复格式问题）
      - id: markdown-format
        name: Format Markdown files
        entry: python scripts/format-md.py
        language: system
        types: [markdown]
        pass_filenames: true
        args: []

      # Markdown linting（检查格式，不自动修复）
      - id: markdown-lint
        name: Lint Markdown files
        entry: python scripts/lint-md.py
        language: system
        types: [markdown]
        exclude: '^(README\.md|README\.cn\.md|\.cursor/commands/.*)$'  # 根 README 系列使用通用规范，不执行项目特定规则检查；排除 Cursor 命令文件
        pass_filenames: true
        args: [--check]

      # 规则质量验证（Rule Linter）
      - id: rule-lint
        name: Lint rule files
        entry: python scripts/lint-rules.py
        language: system
        types: [markdown]
        files: '\.(md|mdc)$'
        exclude: '^(README\.md|README\.cn\.md|docs/.*|\.cursor/commands/.*)$'  # 排除根 README 系列、docs/ 目录和 Cursor 命令文件
        pass_filenames: true
        args: [--check]
